<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lx.dao.UserCollectVideoMapper" >
  <resultMap id="BaseResultMap" type="com.lx.model.UserCollectVideo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <result column="userid" property="userid" jdbcType="INTEGER" />
    <result column="vid" property="vid" jdbcType="INTEGER" />

    <association property="user" javaType="com.lx.model.User">
      <id property="userid" column="userid"/>
    </association>

    <association property="video" javaType="com.lx.model.Video">
      <id property="vid" column="vid"></id>
      <result property="vname" column="vname"/>
      <result property="vImage" column="v_image"/>
    </association>
  </resultMap>
  <insert id="insert" parameterType="com.lx.model.UserCollectVideo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into user_collect_video (userid, vid)
    values (#{userid,jdbcType=INTEGER}, #{vid,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.lx.model.UserCollectVideo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into user_collect_video
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="userid != null" >
        userid,
      </if>
      <if test="vid != null" >
        vid,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="userid != null" >
        #{userid,jdbcType=INTEGER},
      </if>
      <if test="vid != null" >
        #{vid,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>


  <!--查询该视频的收藏数 SELECT count(*) from user_collect_video where vid=1-->
  <select id="user_collect_video_count" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    select count(*) from user_collect_video where vid = #{vid,jdbcType=INTEGER}
  </select>

  <!--查询收藏状态 SELECT IFNULL((SELECT COUNT(*) FROM user_collect_video WHERE userid=1 and vid=1),0) -->
  <select id="if_collect" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    SELECT IFNULL((SELECT COUNT(*) FROM user_collect_video WHERE userid=#{userid,jdbcType=INTEGER} and vid=#{vid,jdbcType=INTEGER}),0)
  </select>

  <!--触发收藏-->
  <insert id="collect" parameterType="com.lx.model.UserCollectVideo" >
    insert into user_collect_video (userid,vid) values (#{userid,jdbcType=INTEGER},#{vid,jdbcType=INTEGER})
  </insert>

  <delete id="cancel_collect" parameterType="java.lang.Integer">
    delete  from user_collect_video where userid = #{userid,jdbcType=INTEGER} and vid = #{vid,jdbcType=INTEGER}
  </delete>

  <!--  /*查询个人收藏夹*/-->
  <select id="user_collect_videos" resultMap="BaseResultMap" parameterType="java.lang.Integer">
    select video.vid,video.vname,video.v_image from
    user_collect_video inner join video
    on user_collect_video.vid = video.vid
    JOIN `user`
    ON user_collect_video.userid = `user`.userid
    where user_collect_video.userid = #{userid,jdbcType=INTEGER}
  </select>
</mapper>
